<html>
<head>
    <script src="https://rawgit.com/aframevr/aframe/3035117/dist/aframe-master.min.js"></script>

    <script>
    AFRAME.registerComponent("telerport-point", {
        schema: {
            x: {type: "number", default: 0},
            y: {type: "number", default: 0},
            z: {type: "number", default: 0},
        },
        init:function() {
            var el = this.el;
            var data = this.data;
            var target = document.querySelector("#lookAtCylinder");
            el.addEventListener('mousedown', function() {
                var pos = el.getAttribute("position");
                var cam = document.querySelector("a-camera");
                cam.setAttribute("position", {x: pos.x, y: 5, z: pos.z})

                var camrot = cam.getAttribute("rotation");
            })
        }
    })

    var material = null;
    var objectToTexture = null;
    var textures = [];

    function setTextures() {
      textures.push('obj/boombox/BoomBox_baseColor.png');
      textures.push('obj/boombox/BoomBox_occlusionRoughnessMetallic.png');
      textures.push('obj/boombox/BoomBox_normal.png');
      textures.push('obj/boombox/BoomBox_emissive.png');
    }

    AFRAME.registerComponent("boom-texture", {
      schema: {
        textures: {default: []},
      },

      init: function() {
        var el = this.el;
        var hiddenTextureSelector = document.querySelectorAll(".hiddenTextureSelector");
        objectToTexture = this.el;

        setTextures();

        el.addEventListener('model-loaded', function (e) {
          e.detail.model.traverse(function(node) {
            if (node.isMesh) {
              material = node.material.map ;
            }
          });
        });

        this.el.addEventListener("mousedown", function() {
          var xPos;
          var tLength = textures.length;
          for(var i = 0; i < tLength; i++) {
            xPos = -0.001*(tLength+1)*tLength + 0.0002/0.015 * i;
            hiddenTextureSelector[i].setAttribute("position", {x: xPos, y: 0.015, z: 0});
            hiddenTextureSelector[i].setAttribute("visible", true);
          }
        });

        this.el.addEventListener("mouseup", function() {
            if(textures.length != 0){
                for(var i = 0; i < textures.length; i++) {
                  hiddenTextureSelector[i].setAttribute("visible", false);
                }
            }
          });
      },
    });

    AFRAME.registerComponent("get-texture-type", {
      init: function() {
        var el = this.el;
        var voxels = [];
        voxel = document.querySelectorAll(".voxel");

        el.addEventListener('model-loaded', function (e) {
          e.detail.model.traverse(function(node) {
            if (node.isMesh) {
              material = node.material.map ;
            }
          });
        });

        this.el.addEventListener("mouseup", function(){
          var currentImg = material.image;
          var selectedTexture = el.components.material.data.src;
          for(var i = 0; i < textures.length; i++) {
            if(selectedTexture == textures[i]) {
              currentImg.setAttribute("src", textures[i]);
            }
          }
        });

      }

    });

    AFRAME.registerComponent("cursor-color", {
      init: function() {
        var el = this.el;
        var moseDownColor = false;
        el.addEventListener("mouseenter", function() {
          el.setAttribute("color", "green");
          moseDownColor = true;
        });

        el.addEventListener("mouseleave", function() {
          el.setAttribute("color", "black");
          moseDownColor = false;
        });

      }
    });

    AFRAME.registerComponent("add-mixin", {
      schema: {
        targetTeleportPoint: {default: "string"},
      },
      init: function() {

        var el = this.el;
        var data = this.data;
        var animation = document.createElement("a-animation");

        el.addEventListener("click", function() {
          var animation = document.createElement("a-animation");
          animation.setAttribute("mixin", data.targetTeleportPoint)

          var cam = document.querySelector("[camera]");
          var camPos = Object.values(cam.getAttribute("position"));
          var camPosString = camPos[0] + " " + camPos[1] + " " + camPos[2];
          console.log(camPos[0])
          animation.setAttribute("from", camPosString)
          cam.appendChild(animation)
        });

      }
    });

    </script>
</head>

<body>
    <a-scene>
        <a-assets>
            <a-asset-item id="house" src="obj/house/house.dae"></a-asset-item>
            <a-asset-item id="boombox1" src="obj/boombox/BoomBox.gltf"></a-asset-item>

            <a-mixin id="move-mixin1" attribute="position" from="0 0 0" to="1 5 2"></a-mixin>
            <a-mixin id="move-mixin2" attribute="position" from="0 0 0" to="-9 5 2"></a-mixin>
            <a-mixin id="move-mixin3" attribute="position" from="0 0 0" to="-12 5 2"></a-mixin>
            <a-mixin id="move-mixin4" attribute="position" from="0 0 0" to="-2 5 2"></a-mixin>
            <a-mixin id="move-mixin5" attribute="position" from="0 0 0" to="-2 5 -4"></a-mixin>

            <a-mixin id="voxel1" class="voxel" get-texture-type material="src:obj/boombox/BoomBox_baseColor.png;" geometry="primitive: sphere; radius: 0.005;"></a-mixin>
            <a-mixin id="voxel2" class="voxel" get-texture-type material="src:obj/boombox/BoomBox_occlusionRoughnessMetallic.png;" geometry="primitive: box; height: 0.01; width: 0.01; depth: 0.01;"></a-mixin>
            <a-mixin id="voxel3" class="voxel" get-texture-type material="src:obj/boombox/BoomBox_normal.png;" geometry="primitive: box; height: 0.01; width: 0.01; depth: 0.01;"></a-mixin>
            <a-mixin id="voxel4" class="voxel" get-texture-type material="src:obj/boombox/BoomBox_emissive.png;" geometry="primitive: sphere; radius: 0.005;"></a-mixin>
        </a-assets>

        <a-entity id="camera-wrapper">
            <a-camera position="0 3 0" rotation="0 180 0" wasd-controls="acceleration: 150">
                <a-cursor raycaster="objects: .collidable"  cursor-color></a-cursor>
            </a-camera>
        </a-entity>


        <a-entity collada-model="#house" position="0 0 0"></a-entity>

        <a-cylinder class="moveCamera collidable" add-mixin="targetTeleportPoint: move-mixin1" color="yellow" position="1 1 2" radius="0.5" height="0.01"></a-cylinder>
        <!--fire -->
        <a-cylinder class="moveCamera collidable" add-mixin="targetTeleportPoint: move-mixin2" color="yellow" position="-9 1 2" radius="0.5" height="0.01"></a-cylinder>
        <!-- sleeping room door -->
        <a-cylinder class="moveCamera collidable" add-mixin="targetTeleportPoint: move-mixin3" color="yellow" position="-12 1 2" radius="0.5" height="0.01"></a-cylinder>
        <!-- tv room door -->
        <a-cylinder class="moveCamera collidable" add-mixin="targetTeleportPoint: move-mixin4" color="yellow" position="-2 1 2" radius="0.5" height="0.01"></a-cylinder>
        <!-- tv room -->
        <a-cylinder class="moveCamera collidable" add-mixin="targetTeleportPoint: move-mixin5" color="yellow" position="-2 1 -4" radius="0.5" height="0.01"></a-cylinder>


        <a-entity id="boom1" class="collidable" boom-texture gltf-model="#boombox1" scale="50 50 50" position="0 3.5 4" rotation="0 180 0">
            <a-entity class="hiddenTextureSelector" mixin="voxel1" visible="false">
              <a-animation attribute="rotation" dur="3000" to="0 360 0" repeat="indifinite" easing="linear"></a-animation>
            </a-entity>
            <a-box class="hiddenTextureSelector" mixin="voxel2" visible="false">
              <a-animation attribute="rotation" dur="3000" to="0 360 0" repeat="indifinite" easing="linear"></a-animation>
            </a-box>
            <a-box class="hiddenTextureSelector" mixin="voxel3" visible="false">
              <a-animation attribute="rotation" dur="3000" to="0 360 0" repeat="indifinite" easing="linear"></a-animation>
            </a-box>
            <a-entity class="hiddenTextureSelector" mixin="voxel4" visible="false">
              <a-animation attribute="rotation" dur="3000" to="0 360 0" repeat="indifinite" easing="linear"></a-animation>
            </a-entity>
        </a-entity>

    </a-scene>

</body>
</html>
